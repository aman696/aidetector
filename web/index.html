<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Detector</title>
    <meta name="description" content="Find out if an image was made by an AI or taken by a real camera.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #0a0e1a;
            --bg2: #111827;
            --card: #1a2035;
            --card2: #1f2847;
            --border: #2a3454;
            --text: #f1f5f9;
            --text2: #94a3b8;
            --muted: #64748b;
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --cyan: #06b6d4;
            --green: #10b981;
            --green-bg: #10b98118;
            --red: #ef4444;
            --red-bg: #ef444418;
            --yellow: #f59e0b;
            --yellow-bg: #f59e0b18;
            --orange: #f97316;
            --amber: #d97706;
            --amber-bg: #d9770610;
            --grad: linear-gradient(135deg, #3b82f6, #8b5cf6);
            --grad-real: linear-gradient(135deg, #10b981, #06b6d4);
            --grad-ai: linear-gradient(135deg, #ef4444, #f97316);
            --grad-ss: linear-gradient(135deg, #d97706, #f97316);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* â”€â”€â”€ Mode Selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .mode-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.1rem;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.35rem;
        }

        .mode-btn {
            flex: 1;
            padding: 0.6rem 0.75rem;
            border: none;
            border-radius: 9px;
            font-family: inherit;
            font-size: 0.88rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.22s;
            background: transparent;
            color: var(--muted);
        }

        .mode-btn.active-normal {
            background: var(--grad);
            color: #fff;
            box-shadow: 0 2px 12px rgba(59, 130, 246, .35);
        }

        .mode-btn.active-screenshot {
            background: var(--grad-ss);
            color: #fff;
            box-shadow: 0 2px 12px rgba(217, 119, 6, .35);
        }

        /* amber tint on upload zone in screenshot mode */
        body.ss-mode .upload-zone {
            border-color: var(--amber);
        }

        body.ss-mode .upload-zone:hover {
            box-shadow: 0 0 30px rgba(217, 119, 6, .2);
        }

        body.ss-mode .analyze-btn {
            background: var(--grad-ss);
        }

        /* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .header {
            text-align: center;
            padding: 2.5rem 1.5rem 1.8rem;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 800;
            background: var(--grad);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--text2);
            font-size: 0.95rem;
            margin-top: 0.4rem;
        }

        .container {
            max-width: 820px;
            margin: 0 auto;
            padding: 1.5rem 1.25rem 4rem;
        }

        /* â”€â”€â”€ Upload Zone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 2.5rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--bg2);
            position: relative;
            overflow: hidden;
        }

        .upload-zone::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, .05), transparent 70%);
            pointer-events: none;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: var(--blue);
            background: var(--card);
            box-shadow: 0 0 30px rgba(59, 130, 246, .12);
        }

        .upload-icon {
            font-size: 2.8rem;
            margin-bottom: 0.8rem;
            opacity: .65;
        }

        .upload-zone h3 {
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .upload-zone p {
            color: var(--muted);
            font-size: 0.82rem;
        }

        .upload-tip {
            display: inline-block;
            margin-top: 0.55rem;
            font-size: 0.75rem;
            color: var(--amber);
            background: var(--amber-bg);
            border: 1px solid #d9770628;
            border-radius: 7px;
            padding: 0.28rem 0.75rem;
        }

        .browse-btn {
            display: inline-block;
            margin-top: 0.9rem;
            padding: 0.55rem 1.4rem;
            background: var(--grad);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform .2s, box-shadow .2s;
        }

        .browse-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, .3);
        }

        #fileInput {
            display: none;
        }

        /* â”€â”€â”€ Preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .preview-area {
            display: none;
            margin-top: 1.25rem;
            border-radius: 12px;
            overflow: hidden;
            background: var(--bg2);
            border: 1px solid var(--border);
        }

        .preview-area.visible {
            display: block;
        }

        .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.7rem 1rem;
            background: var(--card);
            border-bottom: 1px solid var(--border);
        }

        .preview-filename {
            font-size: 0.82rem;
            font-weight: 500;
            color: var(--text2);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 60%;
        }

        .preview-size {
            font-size: 0.72rem;
            color: var(--muted);
        }

        .preview-img-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            max-height: 320px;
            overflow: hidden;
        }

        .preview-img-container img {
            max-width: 100%;
            max-height: 290px;
            border-radius: 8px;
            object-fit: contain;
        }

        /* â”€â”€â”€ Analyze Button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .analyze-btn {
            display: none;
            width: 100%;
            margin-top: 0.9rem;
            padding: 0.85rem;
            background: var(--grad);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .analyze-btn.visible {
            display: block;
        }

        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, .35);
        }

        .analyze-btn:disabled {
            opacity: .55;
            cursor: not-allowed;
        }

        /* â”€â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            margin-top: 1.5rem;
        }

        .loading.visible {
            display: block;
        }

        .spinner {
            width: 38px;
            height: 38px;
            border: 3px solid var(--border);
            border-top-color: var(--blue);
            border-radius: 50%;
            animation: spin .8s linear infinite;
            margin: 0 auto 0.9rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading p {
            color: var(--text2);
            font-size: 0.88rem;
        }

        /* â”€â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .results {
            display: none;
            margin-top: 1.5rem;
            animation: fadeUp .45s ease;
        }

        .results.visible {
            display: block;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(14px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* â”€â”€â”€ Screenshot Warning â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .screenshot-warning {
            display: none;
            background: #78350f18;
            border: 1px solid #d9770640;
            border-left: 4px solid var(--orange);
            border-radius: 10px;
            padding: 1rem 1.1rem;
            margin-bottom: 1rem;
            font-size: 0.87rem;
        }

        .screenshot-warning.visible {
            display: block;
        }

        .screenshot-warning strong {
            display: block;
            color: var(--orange);
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .screenshot-warning span {
            color: var(--text2);
        }

        /* â”€â”€â”€ Verdict Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .verdict-card {
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .4);
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .verdict-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .verdict-card.real {
            background: var(--card);
            border: 1px solid #10b98130;
        }

        .verdict-card.real::before {
            background: var(--grad-real);
        }

        .verdict-card.ai {
            background: var(--card);
            border: 1px solid #ef444440;
        }

        .verdict-card.ai::before {
            background: var(--grad-ai);
        }

        .verdict-emoji {
            font-size: 2.4rem;
            margin-bottom: 0.4rem;
        }

        .verdict-label {
            font-size: 1.55rem;
            font-weight: 800;
            letter-spacing: -.01em;
        }

        .verdict-card.real .verdict-label {
            color: var(--green);
        }

        .verdict-card.ai .verdict-label {
            color: var(--red);
        }

        .verdict-confidence {
            font-size: 0.88rem;
            color: var(--text2);
            margin-top: 0.25rem;
        }

        .verdict-plain {
            margin-top: 0.8rem;
            padding: 0.7rem 1rem;
            border-radius: 8px;
            font-size: 0.87rem;
            line-height: 1.5;
        }

        .verdict-card.real .verdict-plain {
            background: var(--green-bg);
            color: #6ee7b7;
        }

        .verdict-card.ai .verdict-plain {
            background: var(--red-bg);
            color: #fca5a5;
        }

        .verdict-meta {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 0.75rem;
            font-size: 0.72rem;
            color: var(--muted);
        }

        /* â”€â”€â”€ Analyzer Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .section-title {
            font-size: 0.72rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .09em;
            color: var(--muted);
            margin: 1.25rem 0 0.6rem;
        }

        .analyzer-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.65rem;
        }

        @media (max-width: 560px) {
            .analyzer-grid {
                grid-template-columns: 1fr;
            }
        }

        .acard {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.1rem;
            transition: border-color .25s;
        }

        .acard:hover {
            border-color: var(--blue);
        }

        .acard-top {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 0.5rem;
        }

        .acard-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .acard-info {
            flex: 1;
        }

        .acard-name {
            font-size: 0.82rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.05rem;
        }

        .acard-what {
            font-size: 0.74rem;
            color: var(--muted);
            line-height: 1.4;
        }

        .acard-result {
            text-align: right;
            flex-shrink: 0;
        }

        .acard-verdict {
            font-size: 0.78rem;
            font-weight: 700;
            padding: 0.2rem 0.55rem;
            border-radius: 6px;
            white-space: nowrap;
        }

        .acard-verdict.pass {
            background: var(--green-bg);
            color: var(--green);
        }

        .acard-verdict.warn {
            background: var(--yellow-bg);
            color: var(--yellow);
        }

        .acard-verdict.fail {
            background: var(--red-bg);
            color: var(--red);
        }

        .acard-bar-wrap {
            margin-top: 0.7rem;
            height: 5px;
            background: var(--bg);
            border-radius: 4px;
            overflow: hidden;
        }

        .acard-bar {
            height: 100%;
            border-radius: 4px;
            transition: width .8s ease;
        }

        .acard-bar.pass {
            background: var(--green);
        }

        .acard-bar.warn {
            background: var(--yellow);
        }

        .acard-bar.fail {
            background: var(--red);
        }

        .acard-meaning {
            margin-top: 0.55rem;
            font-size: 0.74rem;
            color: var(--text2);
            line-height: 1.45;
        }

        /* â”€â”€â”€ Expert Details Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .details-toggle {
            display: block;
            width: 100%;
            margin-top: 1rem;
            padding: 0.65rem;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text2);
            font-size: 0.82rem;
            font-weight: 500;
            cursor: pointer;
            transition: all .2s;
            font-family: inherit;
        }

        .details-toggle:hover {
            background: var(--card2);
            color: var(--text);
        }

        .details-panel {
            display: none;
            margin-top: 0.65rem;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.1rem;
            animation: fadeUp .3s ease;
        }

        .details-panel.visible {
            display: block;
        }

        .details-note {
            font-size: 0.76rem;
            color: var(--muted);
            margin-bottom: 0.9rem;
            line-height: 1.4;
            background: rgba(59, 130, 246, .07);
            border-radius: 8px;
            padding: 0.55rem 0.75rem;
        }

        .dsection {
            margin-bottom: 0.9rem;
        }

        .dsection-title {
            font-size: 0.72rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .07em;
            color: var(--blue);
            margin-bottom: 0.4rem;
        }

        .drow {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding: 0.22rem 0;
            font-size: 0.78rem;
            border-bottom: 1px solid #ffffff06;
        }

        .drow .dkey {
            color: var(--text2);
            flex: 1;
        }

        .drow .dval {
            color: var(--text);
            font-weight: 500;
            margin-left: 0.75rem;
        }

        .drow .dtip {
            color: var(--muted);
            font-size: 0.68rem;
            margin-left: 0.5rem;
            font-style: italic;
        }

        /* â”€â”€â”€ Error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .error-msg {
            display: none;
            margin-top: 1rem;
            padding: 0.9rem 1rem;
            background: var(--red-bg);
            border: 1px solid #ef444435;
            border-radius: 10px;
            color: var(--red);
            font-size: 0.84rem;
        }

        .error-msg.visible {
            display: block;
        }
    </style>
</head>

<body>

    <div class="header">
        <h1>ğŸ” AI Image Detector</h1>
        <p>Upload any image to find out if it was made by an AI or captured by a real camera</p>
    </div>

    <div class="container">

        <!-- Mode Selector -->
        <div class="mode-selector" id="modeSelector">
            <button class="mode-btn active-normal" id="modeNormal" onclick="setMode('normal')">
                ğŸ“· Downloaded / Camera Image
            </button>
            <button class="mode-btn" id="modeScreenshot" onclick="setMode('screenshot')">
                ğŸ“± Screenshot
            </button>
        </div>

        <!-- Upload Zone -->
        <div class="upload-zone" id="uploadZone">
            <div class="upload-icon">ğŸ“¸</div>
            <h3>Drop an image here</h3>
            <p>Supports JPEG, PNG, WebP &bull; Max 10 MB</p>
            <div class="upload-tip">âœ‚ï¸ For best accuracy, crop the image to show <strong>only the subject</strong> â€”
                remove browser chrome, watermarks, or social media overlays</div>
            <button class="browse-btn" onclick="document.getElementById('fileInput').click()">Browse Files</button>
            <input type="file" id="fileInput" accept=".jpg,.jpeg,.png,.webp">
        </div>

        <!-- Preview -->
        <div class="preview-area" id="previewArea">
            <div class="preview-header">
                <span class="preview-filename" id="previewFilename"></span>
                <span class="preview-size" id="previewSize"></span>
            </div>
            <div class="preview-img-container">
                <img id="previewImg" src="" alt="Preview">
            </div>
        </div>

        <!-- Analyze Button -->
        <button class="analyze-btn" id="analyzeBtn" onclick="analyzeImage()">ğŸ” Analyze Image</button>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Running 8 detection checksâ€¦ this takes about 10â€“15 seconds</p>
        </div>

        <!-- Error -->
        <div class="error-msg" id="errorMsg"></div>

        <!-- Results -->
        <div class="results" id="results">

            <!-- Screenshot Warning -->
            <div class="screenshot-warning" id="screenshotWarning">
                <strong>âš ï¸ This looks like a screenshot</strong>
                <span id="screenshotWarningText"></span>
            </div>

            <!-- Verdict -->
            <div class="verdict-card" id="verdictCard">
                <div class="verdict-emoji" id="verdictEmoji"></div>
                <div class="verdict-label" id="verdictLabel"></div>
                <div class="verdict-confidence" id="verdictConfidence"></div>
                <div class="verdict-plain" id="verdictPlain"></div>
                <div class="verdict-meta" id="verdictMeta"></div>
            </div>

            <!-- 8 Analyzer Cards -->
            <p class="section-title">What the 8 checks found</p>
            <div class="analyzer-grid" id="analyzerGrid">
                <!-- populated by JS -->
            </div>

            <!-- Expert Details Panel -->
            <button class="details-toggle" id="detailsToggle" onclick="toggleDetails()">
                ğŸ”¬ Show raw expert numbers
            </button>
            <div class="details-panel" id="detailsPanel">
                <div class="details-note">
                    These are the raw measurements used by the AI detector.
                    You don't need to understand these to use the tool â€” they're here for researchers and developers.
                </div>
                <div id="detailsInner"></div>
            </div>
        </div>
    </div>

    <script>
        // â”€â”€ Analyzer metadata: plain-English names, descriptions, meanings â”€â”€â”€â”€â”€â”€
        const ANALYZERS = [
            {
                key: 'fft',
                icon: 'ğŸŒŠ',
                name: 'Light & Frequency Patterns',
                what: 'Checks how light energy is spread across the image â€” real photos have a natural dimming at fine details.',
                meaning: {
                    pass: 'The light pattern looks natural â€” matches what a real camera produces.',
                    warn: 'Light pattern is slightly unusual but not conclusive.',
                    fail: 'Light drops off unnaturally â€” a common sign of AI image generation.',
                },
            },
            {
                key: 'eigenvalue',
                icon: 'ğŸ¨',
                name: 'Color Statistics',
                what: 'Examines how the red, green, and blue channels relate to each other â€” real photos have a distinctive color fingerprint.',
                meaning: {
                    pass: 'Color relationships look natural, consistent with a real photograph.',
                    warn: 'Color statistics are slightly off but inconclusive.',
                    fail: 'Color channel relationships deviate from natural photo patterns.',
                },
            },
            {
                key: 'metadata',
                icon: 'ğŸ·ï¸',
                name: 'Camera Information',
                what: 'Looks for hidden camera data (EXIF) â€” real photos contain info like camera model, lens, and GPS.',
                meaning: {
                    pass: 'Camera data found â€” this image carries real photograph metadata.',
                    warn: 'Some camera data present but not complete.',
                    fail: 'No camera data â€” AI images and screenshots never have this.',
                },
            },
            {
                key: 'noise',
                icon: 'ğŸŒ«ï¸',
                name: 'Camera Grain / Sensor Noise',
                what: 'Every real camera adds a tiny, unique pattern of electronic noise to its photos. AI generators don\'t.',
                meaning: {
                    pass: 'Natural sensor noise detected â€” matches real camera output.',
                    warn: 'Noise pattern is unusual but not clearly AI.',
                    fail: 'Noise pattern is too clean or too regular â€” AI images and screenshots often show this.',
                },
            },
            {
                key: 'dct',
                icon: 'ğŸ§©',
                name: 'JPEG Compression Fingerprint',
                what: 'When a photo is saved to JPEG, it leaves a distinctive grid pattern. This check reads that fingerprint.',
                meaning: {
                    pass: 'JPEG patterns match normal camera compression history.',
                    warn: 'Compression history is slightly unusual.',
                    fail: 'JPEG block patterns match AI image output or non-camera sources.',
                },
            },
            {
                key: 'ela',
                icon: 'ğŸ•µï¸',
                name: 'Edit & Manipulation Check',
                what: 'Re-compresses the image and looks for areas that respond differently â€” edited or AI regions stand out.',
                meaning: {
                    pass: 'Compression response is even â€” no signs of editing or AI generation.',
                    warn: 'Some compression irregularities found but inconclusive.',
                    fail: 'Uneven compression response â€” may indicate AI generation or heavy editing.',
                },
            },
            {
                key: 'gradient',
                icon: 'ğŸ“',
                name: 'Edge Sharpness Distribution',
                what: 'Real scenes have a mix of soft and sharp edges. AI images often have unusually uniform edge sharpness.',
                meaning: {
                    pass: 'Edge sharpness varies naturally, as expected in real photographs.',
                    warn: 'Edge distribution is slightly atypical.',
                    fail: 'Edge sharpness is too uniform â€” a common artifact of AI generators.',
                },
            },
            {
                key: 'patchcraft',
                icon: 'ğŸ”¬',
                name: 'Texture Consistency',
                what: 'Compares highly-textured areas (like grass or fabric) with smooth areas (like sky). AI images have an unusual gap between these.',
                meaning: {
                    pass: 'Texture contrast between rough and smooth areas looks natural.',
                    warn: 'Texture contrast is slightly elevated.',
                    fail: 'Unusually high gap between rough and smooth areas â€” a known AI generation artifact.',
                },
            },
        ];

        // Expert key â†’ plain label + tip
        const KEY_LABELS = {
            spectral_slope: { label: 'Frequency slope', tip: 'How fast brightness drops at fine detail' },
            slope_r_squared: { label: 'Slope quality', tip: 'How well it fits a power law' },
            high_freq_ratio: { label: 'Fine detail energy', tip: 'How much energy is in tiny details' },
            spectral_falloff: { label: 'Frequency cutoff', tip: 'Where fine detail disappears' },
            eig_ratio_1_2: { label: 'Color dominance ratio', tip: 'How much one color channel dominates' },
            eig_ratio_2_3: { label: 'Secondary color ratio', tip: 'Balance of the other two channels' },
            eig_dominance: { label: 'Channel dominance', tip: 'Strong = one color overpowers others' },
            has_exif: { label: 'Has EXIF data', tip: '1 = yes (real camera), 0 = no' },
            has_camera_make: { label: 'Has camera brand', tip: 'e.g. Apple, Canon' },
            has_camera_model: { label: 'Has camera model', tip: 'e.g. iPhone 15, EOS R5' },
            has_gps: { label: 'Has GPS location', tip: '1 = location was embedded' },
            has_datetime: { label: 'Has timestamp', tip: '1 = photo date/time present' },
            noise_std: { label: 'Sensor noise level', tip: 'Higher = more natural camera grain' },
            noise_mean: { label: 'Avg. noise value', tip: 'Should be near zero for cameras' },
            texture_rich_mean: { label: 'Avg. texture richness', tip: 'How busy the busiest areas are' },
            texture_poor_mean: { label: 'Avg. smooth area', tip: 'How flat the smoothest areas are' },
            texture_contrast: { label: 'Texture gap', tip: 'Difference between rough and smooth' },
        };

        function labelFor(key) {
            const entry = KEY_LABELS[key];
            return entry ? { label: entry.label, tip: entry.tip } : { label: key.replace(/_/g, ' '), tip: '' };
        }

        // â”€â”€ File handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let selectedFile = null;
        let currentMode = 'normal';

        function setMode(mode) {
            currentMode = mode;
            const normalBtn = document.getElementById('modeNormal');
            const ssBtn = document.getElementById('modeScreenshot');
            if (mode === 'screenshot') {
                normalBtn.className = 'mode-btn';
                ssBtn.className = 'mode-btn active-screenshot';
                document.body.classList.add('ss-mode');
            } else {
                normalBtn.className = 'mode-btn active-normal';
                ssBtn.className = 'mode-btn';
                document.body.classList.remove('ss-mode');
            }
            hide('results');
        }

        const zone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
        zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
        zone.addEventListener('drop', e => {
            e.preventDefault();
            zone.classList.remove('dragover');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });
        zone.addEventListener('click', e => { if (e.target.tagName !== 'BUTTON') fileInput.click(); });
        fileInput.addEventListener('change', () => { if (fileInput.files.length) handleFile(fileInput.files[0]); });

        function handleFile(file) {
            const ext = file.name.split('.').pop().toLowerCase();
            if (!['jpg', 'jpeg', 'png', 'webp'].includes(ext)) {
                showError('Unsupported file type. Please use JPEG, PNG, or WebP.');
                return;
            }
            if (file.size > 10 * 1024 * 1024) {
                showError('File too large. Maximum size is 10 MB.');
                return;
            }
            selectedFile = file;
            hideError();
            hide('results');

            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('previewFilename').textContent = file.name;
                document.getElementById('previewSize').textContent = formatSize(file.size);
                show('previewArea');
                show('analyzeBtn');
            };
            reader.readAsDataURL(file);
        }

        // â”€â”€ Analysis â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function analyzeImage() {
            if (!selectedFile) return;
            hide('results');
            hide('analyzeBtn');
            hideError();
            show('loading');

            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('mode', currentMode);


            try {
                const resp = await fetch('/api/detect', { method: 'POST', body: formData });
                if (!resp.ok) {
                    const err = await resp.json();
                    throw new Error(err.detail || 'Analysis failed');
                }
                const data = await resp.json();
                displayResults(data);
            } catch (err) {
                showError(err.message);
            } finally {
                hide('loading');
                show('analyzeBtn');
            }
        }

        // â”€â”€ Render results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function displayResults(data) {
            const isAI = data.label === 'AI-Generated';

            // Screenshot warning
            const sw = document.getElementById('screenshotWarning');
            if (data.screenshot_warning) {
                document.getElementById('screenshotWarningText').textContent =
                    'Screenshots often get misclassified because they share properties with AI images ' +
                    '(no camera grain, no EXIF, no JPEG fingerprint). ' +
                    'The result below may not be accurate for this image.';
                sw.classList.add('visible');
            } else {
                sw.classList.remove('visible');
            }

            // Verdict card
            const card = document.getElementById('verdictCard');
            card.className = 'verdict-card ' + (isAI ? 'ai' : 'real');
            document.getElementById('verdictEmoji').textContent = isAI ? 'ğŸ¤–' : 'ğŸ“·';
            document.getElementById('verdictLabel').textContent = isAI ? 'Likely AI-Generated' : 'Likely a Real Photo';
            document.getElementById('verdictConfidence').textContent = `The detector is ${data.confidence}% confident in this result`;
            document.getElementById('verdictPlain').textContent = isAI
                ? 'Our analysis found patterns that are typical of AI image generators â€” the frequency spread, color statistics, and/or texture fingerprint don\'t match what a real camera produces.'
                : 'Our analysis found patterns consistent with a real photograph â€” natural camera noise, authentic JPEG history, and frequency patterns that match genuine photos.';
            document.getElementById('verdictMeta').innerHTML =
                `<span>Detection method: ${data.method === 'svm' ? 'Machine learning (SVM)' : 'Voting'}</span>` +
                `<span>Analysis time: ${data.analysis_time}s</span>`;

            // Analyzer cards
            buildAnalyzerCards(data.scores);

            // Expert details
            buildDetails(data.details);
            hide('detailsPanel');
            document.getElementById('detailsToggle').textContent = 'ğŸ”¬ Show raw expert numbers';

            show('results');
        }

        function level(score) {
            return score < 0.4 ? 'pass' : score < 0.6 ? 'warn' : 'fail';
        }

        function buildAnalyzerCards(scores) {
            const grid = document.getElementById('analyzerGrid');
            grid.innerHTML = '';

            ANALYZERS.forEach(a => {
                const score = scores[a.key] ?? 0;
                const lv = level(score);
                const pct = Math.round(score * 100);

                const verdictText = {
                    pass: 'âœ“ Looks Real',
                    warn: '~ Uncertain',
                    fail: 'âœ— AI Signal',
                }[lv];

                const meaning = a.meaning[lv];

                const el = document.createElement('div');
                el.className = 'acard';
                el.innerHTML = `
                <div class="acard-top">
                    <div class="acard-icon">${a.icon}</div>
                    <div class="acard-info">
                        <div class="acard-name">${a.name}</div>
                        <div class="acard-what">${a.what}</div>
                    </div>
                    <div class="acard-result">
                        <div class="acard-verdict ${lv}">${verdictText}</div>
                    </div>
                </div>
                <div class="acard-bar-wrap">
                    <div class="acard-bar ${lv}" style="width:${pct}%"></div>
                </div>
                <div class="acard-meaning">${meaning}</div>
            `;
                grid.appendChild(el);
            });
        }

        function buildDetails(details) {
            const inner = document.getElementById('detailsInner');
            inner.innerHTML = '';

            const sectionMeta = {
                fft: { title: 'ğŸŒŠ Light & Frequency', icon: '' },
                eigenvalue: { title: 'ğŸ¨ Color Statistics', icon: '' },
                metadata: { title: 'ğŸ·ï¸ Camera Information', icon: '' },
                noise: { title: 'ğŸŒ«ï¸ Sensor Noise', icon: '' },
                dct: { title: 'ğŸ§© JPEG Compression', icon: '' },
                ela: { title: 'ğŸ•µï¸ Manipulation Check', icon: '' },
                gradient: { title: 'ğŸ“ Edge Sharpness', icon: '' },
                patchcraft: { title: 'ğŸ”¬ Texture Consistency', icon: '' },
            };

            for (const [key, meta] of Object.entries(sectionMeta)) {
                const d = details[key];
                if (!d || Object.keys(d).length === 0) continue;

                const sec = document.createElement('div');
                sec.className = 'dsection';

                let rows = `<div class="dsection-title">${meta.title}</div>`;
                for (const [k, v] of Object.entries(d)) {
                    const { label, tip } = labelFor(k);
                    rows += `<div class="drow">
                    <span class="dkey">${label}</span>
                    ${tip ? `<span class="dtip">${tip}</span>` : ''}
                    <span class="dval">${v}</span>
                </div>`;
                }
                sec.innerHTML = rows;
                inner.appendChild(sec);
            }
        }

        function toggleDetails() {
            const panel = document.getElementById('detailsPanel');
            const btn = document.getElementById('detailsToggle');
            const open = panel.classList.toggle('visible');
            btn.textContent = open ? 'ğŸ”¬ Hide raw expert numbers' : 'ğŸ”¬ Show raw expert numbers';
        }

        // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function show(id) { document.getElementById(id).classList.add('visible'); }
        function hide(id) { document.getElementById(id).classList.remove('visible'); }
        function showError(msg) {
            const el = document.getElementById('errorMsg');
            el.textContent = 'âš  ' + msg;
            el.classList.add('visible');
        }
        function hideError() { document.getElementById('errorMsg').classList.remove('visible'); }
        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
    </script>
</body>

</html>